image: microsoft/dotnet:latest
services:
  - name: microsoft/mssql-server-linux:latest
    alias: sql

stages:
  - build
  - publish

variables:
  test: "Tests"
  ACCEPT_EULA: "Y"
  SA_PASSWORD: SomeStrong!Passw0rd
  SemVer: $(gitversion -showvariable FullSemVer)

before_script:
  - "dotnet restore"

build:
  stage: build
  script:
    - "dotnet build"

publish:
  stage: publish
  script:
    - "dotnet tool install --global GitVersion.Tool --version 4.0.0"
    - "dotnet pack -p:PackageVersion=$SemVer"
    - "dotnet nuget push ./SharpCheddar.Core/bin/Debug/SharpCheddar.Core*.nupkg -k $sharpcheddar_nuget_key -s https://api.nuget.org/v3/index.json"
    - "dotnet nuget push ./SharpCheddar.EntityFrameworkCore/bin/Debug/SharpCheddar.EFCore*.nupkg -k $sharpcheddar_nuget_key -s https://api.nuget.org/v3/index.json"
